<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Men√∫ Principal - Gaming Social</title>
</head>

<body>
  <!-- Skip Links para accesibilidad -->
  <div class="skip-links">
    <a href="#main-content" class="skip-link">Saltar al contenido principal</a>
    <a href="#navigation-tabs" class="skip-link">Saltar a navegaci√≥n de tabs</a>
    <a href="#add-publication" class="skip-link">Saltar a agregar publicaci√≥n</a>
  </div>

  <app-header-nav></app-header-nav>

  <!-- Contenido principal de la aplicaci√≥n -->
  <main class="menu-principal container-fluid" 
        role="main" 
        id="main-content"
        aria-label="Feed principal de publicaciones gaming">
    <div class="row">
      <div class="col-12">
        <section class="publicaciones-container" 
                 aria-label="Secci√≥n de publicaciones y navegaci√≥n">
          <br>
          <!-- Navegaci√≥n de tabs con sem√°ntica mejorada -->
          <nav aria-label="Navegaci√≥n principal del feed" id="navigation-tabs">
            <ul class="nav nav-tabs" role="tablist" aria-label="Categor√≠as de publicaciones">
              <li class="nav-item" role="presentation">
                <button class="nav-link" 
                       [class.active]="isTabActive(TabType.HOME)" 
                       (click)="setActiveTab(TabType.HOME)"
                       role="tab"
                       tabindex="0"
                       [attr.aria-selected]="isTabActive(TabType.HOME)"
                       aria-controls="publicaciones-panel"
                       id="publicaciones-tab"
                       [attr.aria-expanded]="isTabActive(TabType.HOME)"
                       (keydown.enter)="setActiveTab(TabType.HOME)"
                       (keydown.space)="setActiveTab(TabType.HOME); $event.preventDefault()">
                  <span aria-hidden="true">üì∞</span>
                  Publicaciones
                  <span class="sr-only">({{ isTabActive(TabType.HOME) ? 'actualmente seleccionado' : 'no seleccionado' }})</span>
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" 
                       [class.active]="isTabActive(TabType.MY_PUBLICATIONS)" 
                       (click)="setActiveTab(TabType.MY_PUBLICATIONS)"
                       role="tab"
                       tabindex="0"
                       [attr.aria-selected]="isTabActive(TabType.MY_PUBLICATIONS)"
                       aria-controls="mis-publicaciones-panel"
                       id="mis-publicaciones-tab"
                       [attr.aria-expanded]="isTabActive(TabType.MY_PUBLICATIONS)"
                       (keydown.enter)="setActiveTab(TabType.MY_PUBLICATIONS)"
                       (keydown.space)="setActiveTab(TabType.MY_PUBLICATIONS); $event.preventDefault()">
                  <span aria-hidden="true">üë§</span>
                  Mis publicaciones
                  <span class="sr-only">({{ isTabActive(TabType.MY_PUBLICATIONS) ? 'actualmente seleccionado' : 'no seleccionado' }})</span>
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" 
                       [class.active]="isTabActive(TabType.SAVED_PUBLICATIONS)" 
                       (click)="setActiveTab(TabType.SAVED_PUBLICATIONS)"
                       role="tab"
                       tabindex="0"
                       [attr.aria-selected]="isTabActive(TabType.SAVED_PUBLICATIONS)"
                       aria-controls="guardadas-panel"
                       id="guardadas-tab"
                       [attr.aria-expanded]="isTabActive(TabType.SAVED_PUBLICATIONS)"
                       (keydown.enter)="setActiveTab(TabType.SAVED_PUBLICATIONS)"
                       (keydown.space)="setActiveTab(TabType.SAVED_PUBLICATIONS); $event.preventDefault()">
                  <span aria-hidden="true">‚≠ê</span>
                  Publicaciones guardadas
                  <span class="sr-only">({{ isTabActive(TabType.SAVED_PUBLICATIONS) ? 'actualmente seleccionado' : 'no seleccionado' }})</span>
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="btn btn-info nav-link" 
                        (click)="openModal()"
                        type="button"
                        id="add-publication"
                        aria-label="Abrir modal para agregar nueva publicaci√≥n gaming">
                  <i class="fas fa-plus" aria-hidden="true"></i>
                  <span>Agregar publicaci√≥n</span>
                  <span class="sr-only">- Crear nueva publicaci√≥n gaming</span>
                </button>
              </li>
            </ul>
          </nav>

          <!-- Paneles de contenido con sem√°ntica mejorada -->
          <div class="tab-content" 
               role="region" 
               aria-live="polite" 
               aria-atomic="false"
               style="will-change: transform;">
            <!-- Status live region para cambios de tab -->
            <div class="sr-only" 
                 role="status" 
                 aria-live="assertive" 
                 aria-atomic="true"
                 id="tab-status">
              {{ getCurrentTabStatus() }}
            </div>

            <!-- Panel Publicaciones -->
            <article *ngIf="isTabActive(TabType.HOME)" 
                    class="categoria tab-pane-content"
                    role="tabpanel"
                    id="publicaciones-panel"
                    aria-labelledby="publicaciones-tab"
                    [attr.aria-hidden]="!isTabActive(TabType.HOME)"
                    tabindex="-1"
                    style="will-change: opacity, transform;">
              <header>
                <h2 id="publicaciones-heading">
                  <i class="fas fa-globe" aria-hidden="true"></i>
                  Publicaciones p√∫blicas
                </h2>
                <p class="section-description">
                  Descubre las √∫ltimas publicaciones de la comunidad gaming
                </p>
              </header>
              <section class="contenedor-cards" 
                       aria-label="Lista de publicaciones p√∫blicas"
                       aria-describedby="publicaciones-heading">
                <app-modulocomponentepublicaciones 
                  [nombreusuario]="nombreUsuario"
                  [InfoPublicacion]="obtenerCategoriaPublicaciones(PublicationCategory.ALL)" 
                  [posicion]="PublicationCategory.ALL" 
                  [Corrreousuario]="correoUsuario">
                </app-modulocomponentepublicaciones>
              </section>
            </article>
            
            <!-- Panel Mis Publicaciones -->
            <article *ngIf="isTabActive(TabType.MY_PUBLICATIONS)" 
                    class="categoria tab-pane-content"
                    role="tabpanel"
                    id="mis-publicaciones-panel"
                    aria-labelledby="mis-publicaciones-tab"
                    [attr.aria-hidden]="!isTabActive(TabType.MY_PUBLICATIONS)"
                    tabindex="-1"
                    style="will-change: opacity, transform;">
              <header>
                <h2 id="mis-publicaciones-heading">
                  <i class="fas fa-user-edit" aria-hidden="true"></i>
                  Mis Publicaciones
                </h2>
                <p class="section-description">
                  Administra y revisa tus publicaciones gaming
                </p>
              </header>
              <section class="contenedor-cards" 
                       aria-label="Lista de mis publicaciones personales"
                       aria-describedby="mis-publicaciones-heading">
                <app-modulocomponentepublicaciones 
                  [nombreusuario]="nombreUsuario"
                  [InfoPublicacion]="obtenerCategoriaPublicaciones(PublicationCategory.MY_PUBLICATIONS)" 
                  [posicion]="PublicationCategory.MY_PUBLICATIONS" 
                  [Corrreousuario]="correoUsuario">
                </app-modulocomponentepublicaciones>
              </section>
            </article>
            
            <!-- Panel Guardadas -->
            <article *ngIf="isTabActive(TabType.SAVED_PUBLICATIONS)" 
                    class="categoria tab-pane-content"
                    role="tabpanel"
                    id="guardadas-panel"
                    aria-labelledby="guardadas-tab"
                    [attr.aria-hidden]="!isTabActive(TabType.SAVED_PUBLICATIONS)"
                    tabindex="-1"
                    style="will-change: opacity, transform;">
              <header>
                <h2 id="guardadas-heading">
                  <i class="fas fa-bookmark" aria-hidden="true"></i>
                  Publicaciones guardadas
                </h2>
                <p class="section-description">
                  Tus publicaciones favoritas guardadas para m√°s tarde
                </p>
              </header>
              <section class="contenedor-cards" 
                       aria-label="Lista de publicaciones guardadas"
                       aria-describedby="guardadas-heading">
                <app-modulocomponentepublicaciones 
                  [nombreusuario]="nombreUsuario"
                  [InfoPublicacion]="obtenerCategoriaPublicaciones(PublicationCategory.SAVED_PUBLICATIONS)" 
                  [posicion]="PublicationCategory.SAVED_PUBLICATIONS" 
                  [Corrreousuario]="correoUsuario">
                </app-modulocomponentepublicaciones>
              </section>
            </article>
          </div>
        </section>
      </div>
    </div>
  </main>

<!-- Modal Nativo Angular con estructura optimizada -->
<aside *ngIf="isModalOpen" 
       class="modal-backdrop-custom" 
       (click)="onBackdropClick($event)"
       (keydown.escape)="onEscapeKey($event)"
       tabindex="-1"
       role="dialog"
       aria-labelledby="modalTitle"
       aria-describedby="modalDescription"
       aria-modal="true">
  <div class="modal-dialog-custom" role="document">
    <div class="modal-content-custom">
      <!-- Header del modal -->
      <header class="modal-header-custom">
        <h3 id="modalTitle" class="modal-title-custom">Crear nueva publicaci√≥n</h3>
        <p id="modalDescription" class="modal-description sr-only">
          Formulario para crear y compartir una nueva publicaci√≥n gaming
        </p>
        <button type="button" 
                class="btn-close-modal" 
                (click)="closeModal()"
                aria-label="Cerrar ventana modal">
          <i class="fas fa-times" aria-hidden="true"></i>
        </button>
      </header>
      
      <!-- Formulario del modal -->
      <form class="modal-body-custom" 
            id="publicationForm"
            #publicationForm="ngForm" 
            (ngSubmit)="onSubmit()"
            novalidate
            style="will-change: transform;">

        <!-- TITULO DE LA PUBLICACION -->
        <fieldset class="form-group-custom">
          <label for="titulo-publicacion" class="form-label-custom">
            <span class="required-indicator">*</span>
            T√≠tulo de la publicaci√≥n
          </label>
          <input [(ngModel)]="register.titulo" 
                 name="titulo"
                 id="titulo-publicacion" 
                 class="form-control-custom" 
                 type="text" 
                 placeholder="Ej: Mi mejor jugada en Fortnite"
                 maxlength="100"
                 autocomplete="off"
                 required
                 #tituloInput="ngModel">
          <div class="form-feedback" 
               *ngIf="tituloInput.invalid && tituloInput.touched"
               role="alert"
               aria-live="polite">
            <small class="error-message">El t√≠tulo es obligatorio</small>
          </div>
          <small class="form-help">M√°ximo 100 caracteres</small>
        </fieldset>

        <fieldset class="file-upload-section">
          <legend class="sr-only">Carga de archivos multimedia</legend>
          <div class="col-10">
            <!-- CARGAR EL ARCHIVO IMAGEN O VIDEO -->
            <div class="file-input-wrapper">
              <label for="archivo-input" class="file-input-label">
                <i class="fas fa-cloud-upload-alt" aria-hidden="true"></i>
                <span class="upload-text">Seleccionar archivo multimedia</span>
                <span class="upload-hint">Im√°genes (JPG, PNG, GIF) o Videos (MP4, WebM)</span>
              </label>
              <input accept=".jpg,.jpeg,.png,.gif,.mp4,.webm" 
                     type="file" 
                     class="file-input-hidden" 
                     id="archivo-input" 
                     name="archivo"
                     aria-describedby="file-help"
                     (change)="handleFileInput($event.target.files)" 
                     #fileInput>
              <small id="file-help" class="form-help">
                Tama√±o m√°ximo: 15MB. Formatos soportados: JPG, PNG, GIF, WebP, BMP, SVG, MP4, AVI, MOV, WebM
              </small>
            </div>

            <!-- PROGRESS BAR OPTIMIZADO CON MEJOR ACCESIBILIDAD Y RENDIMIENTO -->
            <div class="upload-progress" 
                 *ngIf="url && (uploadPercent | async) as percent" 
                 role="status" 
                 aria-live="polite"
                 style="will-change: transform;">
              <div class="progress" 
                   role="progressbar" 
                   [attr.aria-valuenow]="percent"
                   aria-valuemin="0" 
                   aria-valuemax="100"
                   [attr.aria-label]="'Subiendo archivo: ' + percent + '%'">
                <div class="progress-bar progress-bar-striped bg-success"
                     [style.width]="percent + '%'"
                     [style.transition]="'width 0.3s ease'"
                     style="will-change: width; transform: translateZ(0);">
                </div>
              </div>
              <span class="progress-text">
                <i class="fas fa-upload" aria-hidden="true"></i>
                Subiendo: {{ percent | number:'1.0-0' }}%
              </span>
            </div>

          </div>

          <!-- BOT√ìN PARA BORRAR EL ARCHIVO -->
          <div class="col-2">
            <button *ngIf="url" 
                    class="btn-close-file" 
                    (click)='limpiarArchivo()'
                    type="button"
                    aria-label="Eliminar archivo seleccionado y reiniciar carga">
              <i class="fas fa-trash-alt" aria-hidden="true"></i>
              <span class="sr-only">Eliminar</span>
            </button>
          </div>
        </fieldset>

        <!-- PREVIEW DEL ARCHIVO CON MEJOR ACCESIBILIDAD -->
        <section class="file-preview-section" *ngIf="url" aria-label="Vista previa del archivo">
          <h4 class="preview-title">Vista previa</h4>
          <div class="preview-container">
            <img [src]="url" 
                 *ngIf="format === 'image' && url" 
                 class="img-preview-modal" 
                 loading="lazy"
                 decoding="async"
                 [alt]="'Vista previa de la imagen: ' + (register.titulo || 'Sin t√≠tulo')"
                 (load)="onImageLoad($event)"
                 (error)="onImageError($event)"
                 style="will-change: transform;">
            <video [src]="url" 
                   *ngIf="format === 'video' && url" 
                   class="video-preview-modal" 
                   preload="metadata"
                   controls
                   playsinline
                   loading="lazy"
                   [attr.aria-label]="'Video de la publicaci√≥n: ' + (register.titulo || 'Sin t√≠tulo')"
                   (loadeddata)="onVideoLoad($event)"
                   (error)="onVideoError($event)"
                   style="will-change: transform;">
              <p>Tu navegador no soporta la reproducci√≥n de video.</p>
            </video>
          </div>
        </section>

        <!-- DESCRIPCI√ìN DE LA PUBLICACI√ìN -->
        <fieldset class="form-group-custom">
          <label for="descripcion-publicacion" class="form-label-custom">
            Descripci√≥n
          </label>
          <textarea [(ngModel)]="register.descripcion" 
                    name="descripcion"
                    id="descripcion-publicacion"
                    placeholder="Cu√©ntanos sobre tu experiencia gaming, logros, tips o lo que quieras compartir..." 
                    class="form-control-custom textarea-custom" 
                    rows="4"
                    maxlength="500"
                    #descripcionInput="ngModel"></textarea>
          <small class="form-help">
            {{ register.descripcion?.length || 0 }}/500 caracteres
          </small>
        </fieldset>

        <!-- DETALLES DEL VIDEOJUEGO -->
        <fieldset class="gaming-details-section">
          <legend class="form-legend">Detalles del videojuego</legend>
          <div class="gaming-grid">
            <div class="gaming-field">
              <div class="form-group-custom">
                <label for="plataforma-select" class="form-label-custom">
                  <i class="fas fa-gamepad" aria-hidden="true"></i>
                  Plataforma
                </label>
                <select [(ngModel)]="register.plataforma" 
                        id="plataforma-select"
                        name="plataforma"
                        class="form-control-custom select-custom" 
                        aria-describedby="plataforma-help">
                  <option value="">-- Selecciona tu plataforma --</option>
                  <option value="PlayStation">PlayStation</option>
                  <option value="Xbox">Xbox</option>
                  <option value="PC">PC</option>
                  <option value="Nintendo Switch">Nintendo Switch</option>
                  <option value="Nintendo Wii">Nintendo Wii</option>
                  <option value="Mobile">Mobile</option>
                </select>
                <small id="plataforma-help" class="form-help">
                  Selecciona la plataforma donde juegas
                </small>
              </div>
            </div>

            <div class="gaming-field">
              <div class="form-group-custom">
                <label for="videojuego-input" class="form-label-custom">
                  <i class="fas fa-trophy" aria-hidden="true"></i>
                  Videojuego
                </label>
                <input [(ngModel)]="register.videojuego" 
                       name="videojuego"
                       id="videojuego-input"
                       class="form-control-custom"
                       placeholder="Ej: Fortnite, Minecraft, Call of Duty..." 
                       type="text"
                       maxlength="50"
                       autocomplete="off">
                <small class="form-help">
                  ¬øQu√© juego est√°s jugando?
                </small>
              </div>
            </div>
          </div>
        </fieldset>

      </form>
      <!-- Footer del modal con botones mejorados -->
      <footer class="modal-footer-custom">
        <div class="button-group">
          <button #btnCerrar
                  (click)='closeModal()' 
                  type="button" 
                  class="btn-secondary-custom" 
                  [disabled]="buttonsDisabled"
                  aria-label="Cancelar y cerrar modal">
            <i class="fas fa-times" aria-hidden="true"></i>
            <span class="btn-text">Cancelar</span>
          </button>
          
          <button #btnPublicar
                  type="submit"
                  form="publicationForm"
                  class="btn-primary-custom" 
                  [disabled]="buttonsDisabled || publicationForm.invalid"
                  [attr.aria-label]="buttonsDisabled ? 'Publicando...' : 'Publicar nueva publicaci√≥n'"
                  *ngIf="activador">
            <i class="fas fa-paper-plane" aria-hidden="true"></i>
            <span class="btn-text">
              {{ buttonsDisabled ? 'Publicando...' : 'Publicar' }}
            </span>
          </button>
        </div>
        
        <!-- Indicador de estado -->
        <div class="form-status" *ngIf="buttonsDisabled" role="status" aria-live="polite">
          <i class="fas fa-spinner fa-spin" aria-hidden="true"></i>
          <span>Subiendo publicaci√≥n...</span>
        </div>
      </footer>
    </div>
  </div>
</aside>

</body>
</html>
